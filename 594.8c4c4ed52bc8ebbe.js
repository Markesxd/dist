"use strict";(self.webpackChunktpwp=self.webpackChunktpwp||[]).push([[594],{7594:(U,m,i)=>{i.r(m),i.d(m,{HealthComponent:()=>D});var d=i(6814),t=i(9468),r=i(95);class f{createFromForm(l){this.nome=l.get("name")?.value,this.data=l.get("date")?.value,this.gatos=l.get("cats")?.value,this.intervaloDeRepeticao=Number(l.get("repeatInterval")?.value)}}var o=function(s){return s[s.NO_REPEAT=0]="NO_REPEAT",s[s.DAILY=1]="DAILY",s[s.WEEKLY=2]="WEEKLY",s[s.MONTHLY=3]="MONTHLY",s[s.YEARLY=4]="YEARLY",s}(o||{});let v=(()=>{class s{transform(e){switch(e){case o.WEEKLY:return"Semanal";case o.DAILY:return"Diario";case o.MONTHLY:return"Mensal";case o.NO_REPEAT:return"\xdanico";case o.YEARLY:return"Anual"}}static#t=this.\u0275fac=function(a){return new(a||s)};static#e=this.\u0275pipe=t.Yjl({name:"FormatRepeatInterval",type:s,pure:!0,standalone:!0})}return s})();var C=i(6933),Z=i(2187),T=i(7398),F=i(553),b=i(9862);let p=(()=>{class s{constructor(e){this.http=e,this.baseUrl=F.N.apiUrl+"/evento"}post(e){return this.http.post(this.baseUrl,e,{observe:"response"}).pipe((0,T.U)(a=>a.body))}fetch(){return this.http.get(this.baseUrl)}put(e){return this.http.put(`${this.baseUrl}/${e.id}`,e,{observe:"response"})}delete(e){return this.http.delete(`${this.baseUrl}/${e}`,{observe:"response"})}static#t=this.\u0275fac=function(a){return new(a||s)(t.LFG(b.eN))};static#e=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var u=i(2746);function A(s,l){if(1&s){const e=t.EpF();t.O4$(),t.TgZ(0,"svg",18),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onDelete())}),t._UZ(1,"path",19),t.qZA()}}function _(s,l){if(1&s&&(t.TgZ(0,"option",20),t._uU(1),t.ALo(2,"FormatRepeatInterval"),t.qZA()),2&s){const e=l.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(t.lcZ(2,2,e))}}function w(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"div",21)(1,"input",22),t.NdJ("change",function(n){t.CHM(e);const c=t.oxw();return t.KtG(c.onChangeCat(n))}),t.qZA(),t.TgZ(2,"label",23),t._uU(3),t.qZA()()}if(2&s){const e=l.$implicit;t.xp6(1),t.MGl("id","i",e.id,""),t.Q6J("value",e.id),t.xp6(1),t.MGl("for","i",e.id,""),t.xp6(1),t.Oqu(e.nome)}}let Y=(()=>{class s{constructor(e,a,n,c,h){this.fb=e,this.catService=a,this.eventService=n,this.activeModal=c,this.modalService=h,this.repeatIntervalValues=Object.values(o).filter(M=>!isNaN(M)),this.isNew=!0,this.delete=new t.vpe,this.editForm=this.fb.group({name:["",[r.kI.required]],date:[new Date,[r.kI.required]],repeatInterval:o.NO_REPEAT,cats:[[]]})}ngOnInit(){this.catService.get().subscribe(e=>{this.cats=e.body})}onChangeCat(e){const a=e.target;if(null===a)return;const n=Number(a.value);if(a.checked){const c=this.getCatById(n);if(!c)return;this.pushCat(c)}else this.removeCat(n)}onSubmit(){const e=new f;e.createFromForm(this.editForm),this.activeModal.close(e)}onDelete(){const e=this.modalService.open(C.Y,{centered:!0});e.componentInstance.text="Voc\xea tem certeza que deseja excluir este evento?",e.closed.subscribe(()=>{this.delete.emit(),this.activeModal.dismiss()})}dismiss(){this.activeModal.dismiss()}get formCats(){const e=this.editForm.get("cats")?.value;if(!Array.isArray(e))throw new Error("Cats is not an array!");return e}getCatById(e){return this.cats?.find(a=>a.id===e)}pushCat(e){const a=this.formCats;a.push(e),this.editForm.patchValue({cats:a})}removeCat(e){this.editForm.patchValue({cats:this.formCats.filter(n=>n.id!==e)})}firstTimeLoadCats(e){for(const a of e)this.firstTimeLoadCat(a)}firstTimeLoadDate(){const e=document.querySelector("#date"),a=this.editForm.get("date")?.value??new Date;e.value=function g(s){return`${s.getFullYear()}-${function E(s){return s<10?`0${s}`:`${s}`}(s.getMonth())}-${s.getDate()}`}(a)}firstTimeLoadCat(e){const a=document.querySelector(`#i${e.id}`);a?a.checked=!0:setTimeout(()=>this.firstTimeLoadCat(e),100)}static#t=this.\u0275fac=function(a){return new(a||s)(t.Y36(r.qu),t.Y36(Z.q),t.Y36(p),t.Y36(u.Kz),t.Y36(u.FF))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["create-health-event"]],outputs:{delete:"delete"},standalone:!0,features:[t.jDz],decls:28,vars:7,consts:[[1,"p-3"],[1,"form-header"],[1,"form-title"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 384 512",1,"form-icon",3,"click"],["d","M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"],[3,"formGroup","ngSubmit"],["for","name",1,"form-label"],[1,"d-flex","align-items-center","gap-2"],["type","text","id","name","formControlName","name",1,"form-control"],["xmlns","http://www.w3.org/2000/svg","height","1em","viewBox","0 0 448 512",3,"click",4,"ngIf"],["for","date",1,"form-label"],["type","date","id","date","formControlName","date",1,"form-control"],["for","repeat",1,"form-label"],["formControlName","repeatInterval","id","repeat",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"form-label"],["class","form-check",4,"ngFor","ngForOf"],["type","submit",1,"form-buttom",3,"disabled"],["xmlns","http://www.w3.org/2000/svg","height","1em","viewBox","0 0 448 512",3,"click"],["d","M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"],[3,"value"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"id","value","change"],[1,"mt-1",3,"for"]],template:function(a,n){1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3),t.qZA(),t.O4$(),t.TgZ(4,"svg",3),t.NdJ("click",function(){return n.dismiss()}),t._UZ(5,"path",4),t.qZA()(),t.kcU(),t.TgZ(6,"form",5),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(7,"div")(8,"label",6),t._uU(9,"Nome"),t.qZA(),t.TgZ(10,"div",7),t._UZ(11,"input",8),t.YNc(12,A,2,0,"svg",9),t.qZA()(),t.TgZ(13,"div")(14,"label",10),t._uU(15,"Data"),t.qZA(),t._UZ(16,"input",11),t.qZA(),t.TgZ(17,"div")(18,"label",12),t._uU(19,"Intervalo de Repeti\xe7\xe3o"),t.qZA(),t.TgZ(20,"select",13),t.YNc(21,_,3,4,"option",14),t.qZA()(),t.TgZ(22,"div")(23,"label",15),t._uU(24,"gatos"),t.qZA(),t.YNc(25,w,4,4,"div",16),t.qZA(),t.TgZ(26,"button",17),t._uU(27),t.qZA()()()),2&a&&(t.xp6(3),t.hij("",n.isNew?"Novo":""," Evento"),t.xp6(3),t.Q6J("formGroup",n.editForm),t.xp6(6),t.Q6J("ngIf",!n.isNew),t.xp6(9),t.Q6J("ngForOf",n.repeatIntervalValues),t.xp6(4),t.Q6J("ngForOf",n.cats),t.xp6(1),t.Q6J("disabled",!n.editForm.valid),t.xp6(1),t.Oqu(n.isNew?"Cadastrar":"Salvar"))},dependencies:[d.ez,d.sg,d.O5,r.UX,r._Y,r.YN,r.Kr,r.Fj,r.EJ,r.JJ,r.JL,r.sg,r.u,v]})}return s})();var L=i(4144),N=i(459),H=i(4408);function O(s,l){if(1&s){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"formatDate"),t.qZA(),t.TgZ(6,"td")(7,"span",7),t.O4$(),t.TgZ(8,"svg",2),t.NdJ("click",function(){const c=t.CHM(e).$implicit,h=t.oxw();return t.KtG(h.openModal(c))}),t._UZ(9,"path",8),t.qZA()()()()}if(2&s){const e=l.$implicit;t.xp6(2),t.Oqu(e.nome),t.xp6(2),t.Oqu(t.lcZ(5,2,e.data))}}let D=(()=>{class s{constructor(e,a,n,c){this.healthEventService=e,this.cookieService=a,this.router=n,this.modalService=c,this.showModal=!1}ngOnInit(){this.load()}openModal(e){const a=this.modalService.open(Y);if(e){const n=new Date(e.data??"");a.componentInstance.isNew=!1,a.componentInstance.editForm.patchValue({name:e.nome,date:n,repeatInterval:e.intervaloDeRepeticao}),a.componentInstance.firstTimeLoadCats(e.gatos),setTimeout(()=>{a.componentInstance.firstTimeLoadDate()},200),a.componentInstance.delete.subscribe(()=>this.deleteEvent(e))}a.closed.subscribe(n=>{void 0!==e?(n.id=e.id,this.healthEventService.put(n).subscribe(()=>{this.load()})):this.healthEventService.post(n).subscribe(()=>{this.load()})})}deleteEvent(e){if(!e.id)throw new Error("Evento sem id");this.healthEventService.delete(e.id).subscribe(()=>{this.load()})}load(){this.healthEventService.fetch().subscribe(e=>{this.events=this.futureEvents(e)})}futureEvents(e){return e.forEach(a=>a.data=new Date(a.data)),e.filter(a=>this.filterEvents(a)).sort(this.dateSort)}filterEvents(e){if(this.isEventOnFuture(e))return!0;if(e.intervaloDeRepeticao!==o.NO_REPEAT){for(;!this.isEventOnFuture(e);)this.incrementEventDate(e);return!0}return!1}isEventOnFuture(e){return!!e.data&&new Date<e.data}incrementEventDate(e){if(e.data)switch(e.intervaloDeRepeticao){case o.DAILY:return void e.data.setDate(e.data.getDate()+1);case o.WEEKLY:return void e.data.setDate(e.data.getDate()+7);case o.MONTHLY:return void e.data.setMonth(e.data.getMonth()+1);case o.YEARLY:e.data.setFullYear(e.data.getFullYear()+1)}}dateSort(e,a){if(void 0===e.data||void 0===a.data)throw new Error("A date is undefined");return e.data.getTime()-a.data.getTime()}static#t=this.\u0275fac=function(a){return new(a||s)(t.Y36(p),t.Y36(N.N),t.Y36(H.F0),t.Y36(u.FF))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-health"]],standalone:!0,features:[t.jDz],decls:16,vars:1,consts:[[1,"page-header"],[1,"page-title"],["xmlns","http://www.w3.org/2000/svg","height","1em","viewBox","0 0 512 512",3,"click"],["d","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344V280H168c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H280v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"],[1,"health-content"],[1,"table","table-striped"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between"],["d","M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"]],template:function(a,n){1&a&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2,"Sa\xfade"),t.qZA(),t.O4$(),t.TgZ(3,"svg",2),t.NdJ("click",function(){return n.openModal()}),t._UZ(4,"path",3),t.qZA()(),t.kcU(),t.TgZ(5,"section",4)(6,"table",5)(7,"thead")(8,"tr")(9,"th"),t._uU(10,"Evento"),t.qZA(),t.TgZ(11,"th"),t._uU(12,"data"),t.qZA(),t._UZ(13,"th"),t.qZA()(),t.TgZ(14,"tbody"),t.YNc(15,O,10,4,"tr",6),t.qZA()()()),2&a&&(t.xp6(15),t.Q6J("ngForOf",n.events))},dependencies:[d.ez,d.sg,L.r],styles:[".health-content[_ngcontent-%COMP%]{padding:1rem}"]})}return s})()}}]);